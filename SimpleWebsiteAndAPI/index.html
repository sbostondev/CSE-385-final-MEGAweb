<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>My First Website</title>
	<link rel="import" href="includes/head.html">
</head>
<body>
	
    <div style="margin:32px auto 0px auto;text-align: center;">
        <!--<button id="btnLoadGames" class="btn btn-primary">Load Games</button>-->
        <div id="loadGames"></div>
        <div>
            <div id="manufacturerList" style="margin-top:16px;"></div>
            <div id="gameList" style="margin-top:16px;"></div>
        </div>
    </div>

    <script>
        //service("", "{}", function (response) { }, function (response) { });

        var selectedVendor = 0;

        // Load the tab options automatically
        $("#loadGames").ready(function () {
            var d = "";
            service("getAllConsoles", "{}",
                function (response) {
                    $.each(response, function (index, value) {
                        d += "<button id=\"btn" + value.hardwareManufacturer + "\" onClick=\"getGames(\'" + value.hardwareManufacturer + "\')\">" + value.hardwareManufacturer + "</button>";
                    });
                    $("#manufacturerList").html(d);
                }, function (response) {
                    alert("Error...");
                    console.log(response);
                });
        });

        // Load the games for the first tab automatically
        $("#btnMicrosoft").ready(getGames("Microsoft"));

        function getGames(manufacturer) {
            var d = "<table class='table table-striped table-bordered' style='max-width:700px;margin:auto;'>";
            service("getByConsoleManufacturer", "{m:" + "\'" + manufacturer + "\'" + "}",
                function (response) {
                    $.each(response, function (index, value) {
                        cleansedTitle = value.gameName.replace(/ /g, "_").replace(/:/g, "");
                        console.log(cleansedTitle);
                        d += "<tr>" +
                            "<td id=\"gameName\">" + value.gameName + "</td>" +
                            "<td>" + value.hardwareName + "</td>" +
                            "<td>" + value.genreName + "</td>" +
                            "<td>" + value.gamePublisher + "</td>" +
                            "<td id=\"btn" + cleansedTitle + "Pop\">" + value.popularity + "</td>" +
                            "<td><button id=\"btn" + cleansedTitle + "\" onClick=\"vote(\'" + value.gameName + "\', \'" + cleansedTitle + "\')\">I want to play this.</button>" + "</td>" +
                            "</tr>";
                    });
                    $("#gameList").html(d + "</table>");
                }, function (response) {
                    alert("Error...");
                    console.log(response);
                });
        }

        function vote(gameTitle, gameTitleCleansed) {
            var newPop;

            service("vote", "{gameName:" + "\'" + gameTitle + "\'" + "}",
                function (response) {
                    // Popularity should have updated. Now get the new table values.
                    $.each(response, function (index, value) {
                        newPop = value.popularity;
                        console.log(newPop);
                    });
                    // Render the change to the table
                    console.log("#btn" + gameTitleCleansed + "Pop");
                    $("#btn" + gameTitleCleansed + "Pop").html( "" + newPop);
                }, function (response) {
                    alert("Error...");
                    console.log(response);
                }
            );
        }
    </script>
</body>
</html>


