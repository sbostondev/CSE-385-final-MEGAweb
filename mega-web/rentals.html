<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Rentals</title>
    <link rel="import" href="includes/head.html">
</head>
<body>
    <center><a href="index.html">Back to games</a></center>
    <center>
        <select id='rentalFilter' onchange='getRentals(this.value)'>
            <option value='0'>All</option>
            <option value='1'>Not Returned</option>
            <option value='2'>Overdue</option>
        </select>
    </center>
    <div style="margin-top:16px;">
        <table class="table table-striped table-bordered" style="max-width:700px;margin:auto;">
            <thead>
                <tr>
                    <th>Renter uniqueid</th>
                    <th>Approving officer</th>
                    <th>Game</th>
                    <th>Date Rented</th>
                    <th>Date due</th>
                    <th>Return</th>
                </tr>
            </thead>
            <tbody id="rentalList"></tbody>
</body>
</html>
<script>
    $("#rentalList").ready(getRentals(document.getElementById("rentalFilter").value));

    function getRentals(mode) {
        var d = "";
        service("getRentals", "{mode: \'" + mode + "\'}",
            function (response) {
                $.each(response, function (index, value) {
                    d += "<tr><td>" + value.renter + "</td>" +
                        "<td>" + value.officer + "</td>" +
                        "<td>" + value.name + "</td>" +
                        "<td>" + value.date + "</td>" +
                        "<td>" + value.dueDate + "</td>";
                    if (value.returned) {
                        d += "<td><button type=\"button\" disabled>returned</button></td></tr>";
                    }
                    else {
                        d += "<td id=\"ret" + value.rentalId + "\"><button type=\"button\" onClick=\"returnRental(\'" + value.rentalId + "\')\">return</button></td></tr>";
                    }
                });
                $("#rentalList").html(d);
            });
    }

    function returnRental(id) {
        service("returnRental", "{rentalId: \'" + id + "\'}", function () { });
        $("#ret" + id).html("<button type=\"button\" disabled>returned</button>");
    }
</script>